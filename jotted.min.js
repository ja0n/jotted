!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Jotted=b()}(this,function(){"use strict";function a(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],b=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],c={};return Object.keys(a).forEach(function(b){c[b]=a[b]}),Object.keys(b).forEach(function(d){"undefined"!=typeof c[d]?c[d]=a[d]:c[d]=b[d]}),c}function b(a,b){var c=new window.XMLHttpRequest;c.open("GET",a),c.responseType="text",c.onload=function(){200===c.status?b(null,c.responseText):b(a,c)},c.onerror=function(a){b(a)},c.send()}function c(a,b,c,e,f){return function(b,g){b&&e.push(b),a++,a<c.length?d(a,g,c,e,f):f(e,g)}}function d(a,b,d,e,f){d[a](b,c.apply(this,arguments))}function e(a,b){var c=arguments.length<=2||void 0===arguments[2]?function(){}:arguments[2],e=[];return a.length?void d(0,b,a,e,c):c(e,b)}function f(a,b){var c=null,d=null;return function(){var e=this,f=arguments;c?d=!0:a.apply(this,arguments),clearTimeout(c),c=setTimeout(function(){d&&a.apply(e,f),c=null,d=null},b)}}function g(a,b){if(!a.className)return!1;var c=" "+a.className+" ";return b=" "+b+" ",c.indexOf(b)!==-1}function h(a,b){return g(a,b)?a.className:(a.className&&(b=" "+b),a.className+=b,a.className)}function i(a,b){var c=" "+b,d=b+" ";return a.className.indexOf(c)!==-1?a.className=a.className.replace(c,""):a.className.indexOf(d)!==-1?a.className=a.className.replace(d,""):a.className=a.className.replace(b,""),a.className}function j(a,b){return a.getAttribute("data-"+b)}function k(){var b=arguments.length<=0||void 0===arguments[0]?"":arguments[0],c=arguments.length<=1||void 0===arguments[1]?"":arguments[1],d=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],e=a(d,C);for(var f in e){var g=f.length;if(c.slice(-g++)==="."+f)return e[f]}for(var h in e)if(b===h)return e[h];return b}function l(){return'\n    <ul class="jotted-nav">\n      <li class="jotted-nav-item jotted-nav-item-result">\n        <a href="#" data-jotted-type="result">\n          Result\n        </a>\n      </li>\n      <li class="jotted-nav-item jotted-nav-item-html">\n        <a href="#" data-jotted-type="html">\n          HTML\n        </a>\n      </li>\n      <li class="jotted-nav-item jotted-nav-item-css">\n        <a href="#" data-jotted-type="css">\n          CSS\n        </a>\n      </li>\n      <li class="jotted-nav-item jotted-nav-item-js">\n        <a href="#" data-jotted-type="js">\n          JavaScript\n        </a>\n      </li>\n    </ul>\n    <div class="jotted-pane jotted-pane-result"><iframe></iframe></div>\n    <div class="jotted-pane jotted-pane-html"></div>\n    <div class="jotted-pane jotted-pane-css"></div>\n    <div class="jotted-pane jotted-pane-js"></div>\n  '}function m(a){return"jotted-pane-active-"+a}function n(){return"jotted"}function o(a){return"jotted-has-"+a}function p(){return"jotted-hide-result"}function q(a){return"jotted-editor jotted-editor-"+a}function r(a){var b=arguments.length<=1||void 0===arguments[1]?"":arguments[1];return'\n    <textarea data-jotted-type="'+a+'" data-jotted-file="'+b+'"></textarea>\n    <div class="jotted-status"></div>\n  '}function s(a){return"\n    <p>"+a+"</p>\n  "}function t(a){return"jotted-status-"+a}function u(a){return"jotted-status-active-"+a}function v(a){return"jotted-plugin-"+a}function w(a){return"Loading <strong>"+a+"</strong>.."}function x(a){return"There was an error loading <strong>"+a+"</strong>."}function y(a){for(var b in H){var c=H[b];if(c._id===a)return c}throw new Error("Plugin "+a+" is not registered.")}function z(a,b){b._id=a,H.push(b)}function A(){var a=this;this._get("options").plugins.forEach(function(b){var c=void 0,d=void 0,e={};"string"==typeof b?d=b:"object"===("undefined"==typeof b?"undefined":D(b))&&(d=b.name,e=b.options||{}),c=y(d),a._get("plugins")[d]=new c(a,e),h(a._get("$container"),v(d))})}function B(a){a.plugin("render",J),a.plugin("scriptless",K),a.plugin("ace",L),a.plugin("codemirror",M),a.plugin("less",N),a.plugin("coffeescript",O),a.plugin("stylus",P),a.plugin("babel",Q),a.plugin("markdown",R),a.plugin("console",S),a.plugin("play",T),a.plugin("pen",U)}var C={html:"html",css:"css",js:"javascript",less:"less",styl:"stylus",coffee:"coffeescript"},D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},E=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},F=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),G=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},H=[],I=function(){function a(){E(this,a),this.topics={},this.callbacks={}}return F(a,[{key:"find",value:function(a){return this.topics[a]=this.topics[a]||[],this.topics[a]}},{key:"subscribe",value:function(a,b){var c=arguments.length<=2||void 0===arguments[2]?90:arguments[2],d=this.find(a);b._priority=c,d.push(b),d.sort(function(a,b){return a._priority>b._priority?1:b._priority>a._priority?-1:0})}},{key:"subscribeOnce",value:function(a,b){var c=arguments,d=this,e=arguments.length<=2||void 0===arguments[2]?90:arguments[2],f=function g(){b(c),d.unsubscribe(a,g)};this.subscribe(a,f,e)}},{key:"remover",value:function(a,b){a.forEach(function(){if(!b)return void(a.length=0);var c=[].indexOf.call(a,b);c!==-1&&a.splice(c,1)})}},{key:"unsubscribe",value:function(a,b){var c=this.find(a);this.remover(c,b),this.callbacks[a]=this.callbacks[a]||[],this.remover(this.callbacks[a],b)}},{key:"unsubscribeAll",value:function(){var a=this;Object.keys(this.topics).forEach(function(b){return a.unsubscribe(b)})}},{key:"publish",value:function(a){var b=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],c=this.find(a),d=[];c.forEach(function(a){d.push(a)}),e(d,b,this.runCallbacks(a))}},{key:"runCallbacks",value:function(a){var b=this;return function(c,d){b.callbacks[a]=b.callbacks[a]||[],b.callbacks[a].forEach(function(a){a(c,d)})}}},{key:"done",value:function(a){var b=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];this.callbacks[a]=this.callbacks[a]||[],this.callbacks[a].push(b)}}]),a}(),J=function(){function b(c,d){var e=this;E(this,b),d=a(d,{});var f=!!("srcdoc"in document.createElement("iframe")),g=c.$container.querySelector(".jotted-pane-result iframe"),h="",i={html:"",css:"",js:""};this.jotted=c,this.supportSrcdoc=f,this.content=i,this.frameContent=h,this.$resultFrame=g,this.onMessage=function(a){return e.domready(a)},this.callbacks=[],this.index=0,this.lastCallback=function(){},window.addEventListener("message",this.onMessage),c.on("change",this.change.bind(this),100)}return F(b,[{key:"destroy",value:function(){window.removeEventListener("message",this.onMessage)}},{key:"template",value:function(){var a=arguments.length<=0||void 0===arguments[0]?"":arguments[0],b=arguments.length<=1||void 0===arguments[1]?"":arguments[1],c=arguments.length<=2||void 0===arguments[2]?"":arguments[2];return"\n      <!doctype html>\n      <html>\n        <head>\n          <script>\n            (function () {\n              window.addEventListener('DOMContentLoaded', function () {\n                window.parent.postMessage(JSON.stringify({\n                  type: 'jotted-dom-ready'\n                }), '*')\n              })\n            }())\n          </script>\n\n          <style>"+a+"</style>\n        </head>\n        <body>\n          "+b+"\n\n          <!--\n            Jotted:\n            Empty script tag prevents malformed HTML from breaking the next script.\n          -->\n          <script></script>\n          <script>"+c+"</script>\n        </body>\n      </html>\n    "}},{key:"change",value:function(a,b){var c=this;this.content[a.type]=a.content;var d=this.frameContent;if(this.frameContent=this.template(this.content.css,this.content.html,this.content.js),this.lastCallback=function(){c.lastCallback=function(){},b(null,a)},a.forceRender!==!0&&this.frameContent===d)return void b(null,a);if(this.supportSrcdoc){var e=document.createElement("iframe");this.$resultFrame.parentNode.replaceChild(e,this.$resultFrame),this.$resultFrame=e,this.$resultFrame.contentWindow.document.open(),this.$resultFrame.contentWindow.document.write(this.frameContent),this.$resultFrame.contentWindow.document.close()}else{this.$resultFrame.setAttribute("data-srcdoc",this.frameContent);var f='javascript:window.frameElement.getAttribute("data-srcdoc");';this.$resultFrame.setAttribute("src",f),this.$resultFrame.contentWindow&&(this.$resultFrame.contentWindow.location=f)}this.jotted.trigger("render",this.frameContent)}},{key:"domready",value:function(a){if(a.source===this.$resultFrame.contentWindow){var b={};try{b=JSON.parse(a.data)}catch(a){}"jotted-dom-ready"===b.type&&this.lastCallback()}}}]),b}(),K=function(){function b(c,d){E(this,b),d=a(d,{});var e=["application/javascript","application/ecmascript","application/x-ecmascript","application/x-javascript","text/ecmascript","text/javascript","text/javascript1.0","text/javascript1.1","text/javascript1.2","text/javascript1.3","text/javascript1.4","text/javascript1.5","text/jscript","text/livescript","text/x-ecmascript","text/x-javascript"];c.on("change",this.change.bind(this)),this.runScriptTypes=e}return F(b,[{key:"change",value:function(a,b){if("html"!==a.type)return b(null,a);var c=document.createElement("div");c.innerHTML=a.content;for(var d=null,e=c.querySelectorAll("script"),f=0;f<e.length;f++)d=e[f].getAttribute("type"),d&&this.runScriptTypes.indexOf(d)===-1||e[f].parentNode.removeChild(e[f]);a.content=c.innerHTML,b(null,a)}}]),b}(),L=function(){function b(c,d){E(this,b);var e,f=1;if(this.editor={},this.jotted=c,d=a(d,{}),"undefined"!=typeof window.ace){var g=c.$container.querySelectorAll(".jotted-editor");for(e=0;e<g.length;e++){var h=g[e].querySelector("textarea"),i=j(h,"jotted-type"),l=j(h,"jotted-file"),m=document.createElement("div");g[e].appendChild(m),this.editor[i]=window.ace.edit(m);var n=this.editor[i],o=a(d);n.getSession().setMode("ace/mode/"+k(i,l)),n.getSession().setOptions(o),n.$blockScrolling=1/0}c.on("change",this.change.bind(this),f)}}return F(b,[{key:"editorChange",value:function(a){var b=this;return function(){b.jotted.trigger("change",a)}}},{key:"change",value:function(a,b){var c=this.editor[a.type];a.aceEditor||(c.getSession().setValue(a.content),a.aceEditor=c,c.on("change",this.editorChange(a))),a.content=c.getValue(),b(null,a)}}]),b}(),M=function(){function b(c,d){E(this,b);var e,f=1;this.editor={},this.jotted=c;var g={html:"htmlmixed"};if(d=a(d,{lineNumbers:!0}),"undefined"!=typeof window.CodeMirror){var h=c.$container.querySelectorAll(".jotted-editor");for(e=0;e<h.length;e++){var i=h[e].querySelector("textarea"),l=j(i,"jotted-type"),m=j(i,"jotted-file");this.editor[l]=window.CodeMirror.fromTextArea(i,d),this.editor[l].setOption("mode",k(l,m,g))}c.on("change",this.change.bind(this),f)}}return F(b,[{key:"editorChange",value:function(a){var b=this;return function(){b.jotted.trigger("change",a)}}},{key:"change",value:function(a,b){var c=this.editor[a.type];a.cmEditor||(c.setValue(a.content),a.cmEditor=c,c.on("change",this.editorChange(a))),a.content=c.getValue(),b(null,a)}}]),b}(),N=function(){function b(c,d){E(this,b);var e=20;d=a(d,{}),"undefined"!=typeof window.less&&(c.$container.querySelector('a[data-jotted-type="css"]').innerHTML="Less",c.on("change",this.change.bind(this),e))}return F(b,[{key:"isLess",value:function(a){return"css"===a.type&&(a.file.indexOf(".less")!==-1||""===a.file)}},{key:"change",value:function(a,b){this.isLess(a)?window.less.render(a.content,this.options,function(c,d){return c?b(c,a):(a.content=d.css,void b(null,a))}):b(null,a)}}]),b}(),O=function(){function b(c,d){E(this,b);var e=20;d=a(d,{}),"undefined"!=typeof window.CoffeeScript&&(c.$container.querySelector('a[data-jotted-type="js"]').innerHTML="CoffeeScript",c.on("change",this.change.bind(this),e))}return F(b,[{key:"isCoffee",value:function(a){return"js"===a.type&&(a.file.indexOf(".coffee")!==-1||""===a.file)}},{key:"change",value:function(a,b){if(this.isCoffee(a))try{a.content=window.CoffeeScript.compile(a.content)}catch(c){return b(c,a)}b(null,a)}}]),b}(),P=function(){function b(c,d){E(this,b);var e=20;d=a(d,{}),"undefined"!=typeof window.stylus&&(c.$container.querySelector('a[data-jotted-type="css"]').innerHTML="Stylus",c.on("change",this.change.bind(this),e))}return F(b,[{key:"isStylus",value:function(a){return"css"===a.type&&(a.file.indexOf(".styl")!==-1||""===a.file)}},{key:"change",value:function(a,b){this.isStylus(a)?window.stylus(a.content,this.options).render(function(c,d){return c?b(c,a):(a.content=d,void b(null,a))}):b(null,a)}}]),b}(),Q=function(){function b(c,d){E(this,b);var e=20;if(this.options=a(d,{}),"undefined"!=typeof window.Babel)this.babel=window.Babel;else{if("undefined"==typeof window.babel)return;this.babel={transform:window.babel}}c.$container.querySelector('a[data-jotted-type="js"]').innerHTML="ES2015",c.on("change",this.change.bind(this),e)}return F(b,[{key:"change",value:function(a,b){if("js"===a.type){try{a.content=this.babel.transform(a.content,this.options).code}catch(c){return b(c,a)}b(null,a)}else b(null,a)}}]),b}(),R=function(){function b(c,d){E(this,b);var e=20;this.options=a(d,{}),"undefined"!=typeof window.marked&&(window.marked.setOptions(d),c.$container.querySelector('a[data-jotted-type="html"]').innerHTML="Markdown",c.on("change",this.change.bind(this),e))}return F(b,[{key:"change",value:function(a,b){if("html"===a.type){try{a.content=window.marked(a.content)}catch(c){return b(c,a)}b(null,a)}else b(null,a)}}]),b}(),S=function(){function b(c,d){var e=this;E(this,b),d=a(d,{tabName:"JS Console",autoClear:!1,clearText:"Clear",aliases:null});var f=d.aliases?d.aliases.join(" = ")+" = window.console.log;":"",g=30,i=[],j=0,k="("+this.capture.toString()+")(); "+f,l={html:"",css:"",js:""},m=document.createElement("li");h(m,"jotted-nav-item jotted-nav-item-console"),m.innerHTML='<a href="#" data-jotted-type="console">'+d.tabName+"</a>";var n=document.createElement("div");h(n,"jotted-pane jotted-pane-console"),n.innerHTML='\n      <div class="jotted-console-container">\n        <ul class="jotted-console-output"></ul>\n        <form class="jotted-console-input">\n          <input type="text">\n        </form>\n      </div>\n      <button class="jotted-button jotted-console-clear">'+d.clearText+"</button>\n    ",c.$container.appendChild(n),c.$container.querySelector(".jotted-nav").appendChild(m);var o=c.$container.querySelector(".jotted-console-container"),p=c.$container.querySelector(".jotted-console-output"),q=c.$container.querySelector(".jotted-console-input input"),r=c.$container.querySelector(".jotted-console-input"),s=c.$container.querySelector(".jotted-console-clear");r.addEventListener("submit",this.submit.bind(this)),q.addEventListener("keydown",this.history.bind(this)),s.addEventListener("click",this.clear.bind(this)),d.autoClear===!0&&c.on("change",this.autoClear.bind(this),g-1),c.on("change",this.change.bind(this),g),d.onChange&&c.done("change",function(){return e.lastPool?(e.lastPool=e.pool,e.pool=[],void d.onChange(e.lastPool)):void(e.lastPool=e.pool)}),this.$jottedContainer=c.$container,this.$container=o,this.$input=q,this.$output=p,this.history=i,this.historyIndex=j,this.logCaptureSnippet=k,this.contentCache=l,this.pool=[],this.lastPool=null,this.getIframe=this.getIframe.bind(this),this.onMessage=function(a){return e.getMessage(a)},window.addEventListener("message",this.onMessage)}return F(b,[{key:"destroy",value:function(){window.removeEventListener("message",this.onMessage)}},{key:"getIframe",value:function(){return this.$jottedContainer.querySelector(".jotted-pane-result iframe")}},{key:"getMessage",value:function(a){if(a.source===this.getIframe().contentWindow){var b={};try{b=JSON.parse(a.data)}catch(c){}"jotted-console-log"===b.type&&(this.log(b.message),this.pool.push(b.message))}}},{key:"autoClear",value:function(a,b){var c=a.content;"js"===a.type&&(c=c.replace(this.logCaptureSnippet,"")),a.forceRender!==!0&&this.contentCache[a.type]===c||this.clear(),this.contentCache[a.type]=c,b(null,a)}},{key:"change",value:function(a,b){return"js"!==a.type?b(null,a):(a.content.indexOf(this.logCaptureSnippet)===-1&&(a.content=""+this.logCaptureSnippet+a.content),void b(null,a))}},{key:"capture",value:function(){"undefined"!=typeof window.console&&"undefined"!=typeof window.console.log||(window.console={log:function(){}});var a=Function.prototype.bind.call(window.console.log,window.console);window.console.log=function(){[].slice.call(arguments).forEach(function(a){window.parent.postMessage(JSON.stringify({type:"jotted-console-log",message:a}),"*")}),a.apply(a,arguments)}}},{key:"log",value:function(){var a=arguments.length<=0||void 0===arguments[0]?"":arguments[0],b=arguments[1],c=document.createElement("li");h(c,"jotted-console-log"),"undefined"!=typeof b&&h(c,"jotted-console-log-"+b),c.innerHTML=a,this.$output.appendChild(c)}},{key:"submit",value:function(a){var b=this.$input.value.trim();if(""===b)return a.preventDefault();this.history.push(b),this.historyIndex=this.history.length,this.log(b,"history"),0!==b.indexOf("return")&&(b="return "+b);try{var c=this.getIframe().contentWindow.eval("(function() {"+b+"})()");this.log(c)}catch(d){this.log(d,"error")}this.$input.value="",this.$container.scrollTop=this.$container.scrollHeight,a.preventDefault()}},{key:"clear",value:function(a){a&&a.preventDefault(),this.$output.innerHTML=""}},{key:"history",value:function(a){var b=38,c=40,d=!1,e=this.$input.selectionStart;a.keyCode===b&&0!==this.historyIndex&&0===e&&(this.historyIndex--,d=!0),a.keyCode===c&&this.historyIndex!==this.history.length-1&&e===this.$input.value.length&&(this.historyIndex++,d=!0),d&&(this.$input.value=this.history[this.historyIndex])}}]),b}(),T=function(){function b(c,d){E(this,b),d=a(d,{firstRun:!0,buttonText:"Run"});var e=10,f={},g={};d.firstRun===!1&&(f={html:{type:"html",content:""},css:{type:"css",content:""},js:{type:"js",content:""}});var h=document.createElement("button");h.className="jotted-button jotted-button-play",h.innerHTML=d.buttonText,c.$container.appendChild(h),h.addEventListener("click",this.run.bind(this)),c.on("change",this.change.bind(this),e),this.cache=f,this.code=g,this.jotted=c}return F(b,[{key:"change",value:function(b,c){this.code[b.type]=a(b),"undefined"!=typeof this.cache[b.type]?(c(null,this.cache[b.type]),this.cache[b.type].forceRender=null):(this.cache[b.type]=a(b),c(null,b))}},{key:"run",value:function(b){b&&b.preventDefault();for(var c in this.code)this.cache[c]=a(this.code[c],{forceRender:!0}),this.jotted.trigger("change",this.cache[c])}}]),b}(),U=function(){function a(b,c){E(this,a);var d={html:{title:"HTML",classChecker:"jotted-has-html"},css:{title:"CSS",classChecker:"jotted-has-css"},js:{title:"JavaScript",classChecker:"jotted-has-js"},console:{title:"Console",classChecker:"jotted-plugin-console"}},e=[];for(var f in d)b.$container.classList.contains(d[f].classChecker)&&e.push(b.$container.querySelector(".jotted-pane-"+f));this.resizablePanes=[];for(var g=0;g<e.length;g++){for(var h=void 0,i=0;i<e[g].classList.length;i++)if(e[g].classList[i].indexOf("jotted-pane-")!==-1){h=e[g].classList[i].replace("jotted-pane-","");break}if(h){var j={container:e[g],expander:void 0};this.resizablePanes.push(j);var k=document.createElement("div");k.classList.add("jotted-pane-title"),k.innerHTML=d[h].title||h;var l=e[g].firstElementChild;l.insertBefore(k,l.firstChild),g>0&&(j.expander=document.createElement("div"),j.expander.classList.add("jotted-plugin-pen-expander"),j.expander.addEventListener("mousedown",this.startExpand.bind(this,b)),l.insertBefore(j.expander,k))}}}return F(a,[{key:"startExpand",value:function(a,b){var c=this.resizablePanes.filter(function(a){return a.expander===b.target}).shift(),d=this.resizablePanes[this.resizablePanes.indexOf(c)-1],e=100/parseInt(window.getComputedStyle(c.container.parentNode).width,10);c.container.parentNode.style.display="none",c.startX=b.clientX,c.startWidth=parseFloat(window.getComputedStyle(c.container).width,10),d.startWidth=parseFloat(window.getComputedStyle(d.container).width,10),c.container.parentNode.style.display="",c.mousemove=this.doDrag.bind(this,c,d,e),c.mouseup=this.stopDrag.bind(this,c),document.addEventListener("mousemove",c.mousemove,!1),document.addEventListener("mouseup",c.mouseup,!1)}},{key:"doDrag",value:function(a,b,c,d){var e=b.startWidth+(d.clientX-a.startX)*c,f=a.startWidth-(d.clientX-a.startX)*c,g=10;e>=g&&f>=g&&(a.container.style.maxWidth="none",b.container.style.maxWidth="none",b.container.style.width=e+"%",a.container.style.width=f+"%")}},{key:"stopDrag",value:function(a,b){document.removeEventListener("mousemove",a.mousemove,!1),document.removeEventListener("mouseup",a.mouseup,!1)}}]),a}(),V=function(){function a(b,c){var d=this;if(E(this,a),!b)throw new Error("Can't find Jotted container.");var e=document.createElement("div");b.appendChild(e);var g={};this._get=function(a){return g[a]},this._set=function(a,b){return g[a]=b,g[a]};var i=this._set("options",G({files:[],showBlank:!1,runScripts:!0,pane:"result",debounce:250,plugins:[]},c));i.plugins.indexOf("render")===-1&&(i.plugins=i.plugins.concat("render")),i.runScripts===!1&&i.plugins.push("scriptless"),this._set("cachedContent",{html:null,css:null,js:null});var j=this._set("pubsoup",new I);this._set("trigger",this.trigger()),this._set("on",function(){j.subscribe.apply(j,arguments)}),this._set("once",function(){j.subscribeOnce.apply(j,arguments)}),this._set("off",function(){j.unsubscribe.apply(j,arguments)});var k=this._set("done",function(){j.done.apply(j,arguments)});k("change",this.errors.bind(this));var q=this._set("$container",e);q.innerHTML=l(),h(q,n());var r=this._set("paneActive",i.pane);h(q,m(r)),this._set("$status",{});for(var s=["html","css","js"],t=0;t<s.length;t++){var u=s[t];this.markup(u)}q.addEventListener("keyup",f(this.change.bind(this),i.debounce)),q.addEventListener("change",f(this.change.bind(this),i.debounce)),q.addEventListener("click",this.pane.bind(this)),this.$container=this._get("$container"),this.on=this._get("on"),this.once=this._get("once"),this.off=this._get("off"),this.done=this._get("done"),this.trigger=this._get("trigger"),this.paneActive=this._get("paneActive"),this.plugins=this._set("plugins",{}),A.call(this);for(var v=["html","css","js"],w=0;w<v.length;w++){var x=v[w];this.load(x)}if(i.showBlank)for(var y=["html","css","js"],z=0;z<y.length;z++){var B=y[z];h(q,o(B))}i.tabNames&&this.renameTabs(i.tabNames),i.hideResultTab&&h(q,p());var C=5;this.on("change",function(a,b){d._get("cachedContent")[a.type]=a.content,b(null,a)},C)}return F(a,[{key:"destroy",value:function(){for(var a in this.plugins){var b=this.plugins[a];"function"==typeof b.destroy&&b.destroy()}this._get("pubsoup").unsubscribeAll(),this.$container.parentNode.removeChild(this.$container)}},{key:"findFile",value:function(a){var b={},c=this._get("options");for(var d in c.files){var e=c.files[d];if(e.type===a)return e}return b}},{key:"markup",value:function(a){var b=this._get("$container"),c=b.querySelector(".jotted-pane-"+a),d=this.findFile(a),e=document.createElement("div");e.innerHTML=r(a,d.url),e.className=q(a),c.appendChild(e),this._get("$status")[a]=c.querySelector(".jotted-status"),"undefined"==typeof d.url&&"undefined"==typeof d.content||h(b,o(a))}},{key:"load",value:function(a){var c=this,d=this.findFile(a),e=this._get("$container").querySelector(".jotted-pane-"+a+" textarea");"undefined"!=typeof d.content?this.setValue(e,d.content):"undefined"!=typeof d.url?(this.status("loading",[w(d.url)],{type:a,file:d}),b(d.url,function(b,d){return b?void c.status("error",[x(b)],{type:a}):(c.clearStatus("loading",{type:a}),void c.setValue(e,d))})):this.setValue(e,"")}},{key:"setValue",value:function(a,b){a.value=b,this.change({target:a})}},{key:"getValue",value:function(a){return this._get("cachedContent")[a]}},{key:"updateValue",value:function(a,b){this._get("cachedContent")[a]=b,this.trigger("change",{type:a,content:b})}},{key:"loadFiles",value:function(){var a=this,b=arguments.length<=0||void 0===arguments[0]?[]:arguments[0];b.forEach(function(b){var c=b.type,d=b.content;return a.updateValue(c,d)})}},{key:"change",value:function(a){var b=j(a.target,"jotted-type");if(b){var c=this._get("cachedContent");c[b]!==a.target.value&&(c[b]=a.target.value,this.trigger("change",{type:b,file:j(a.target,"jotted-file"),content:c[b]}))}}},{key:"errors",value:function(a,b){this.status("error",a,b)}},{key:"pane",value:function(a){if(j(a.target,"jotted-type")){var b=this._get("$container"),c=this._get("paneActive");i(b,m(c)),c=this._set("paneActive",j(a.target,"jotted-type")),h(b,m(c)),a.preventDefault()}}},{key:"status",value:function(){var a=arguments.length<=0||void 0===arguments[0]?"error":arguments[0],b=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],c=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(!b.length)return this.clearStatus(a,c);var d=this._get("$status");h(d[c.type],t(a)),h(this._get("$container"),u(c.type));var e="";b.forEach(function(a){e+=s(a)}),d[c.type].innerHTML=e}},{key:"clearStatus",value:function(a,b){var c=this._get("$status");i(c[b.type],t(a)),i(this._get("$container"),u(b.type)),c[b.type].innerHTML=""}},{key:"trigger",value:function(){var a=this._get("options"),b=this._get("pubsoup");if(a.debounce===!1)return function(){b.publish.apply(b,arguments)};var c={},d={};return function(e){var f=arguments,g=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],h=g.type,i=void 0===h?"default":h;c[i]?d[i]=!0:b.publish.apply(b,arguments),clearTimeout(c[i]),c[i]=setTimeout(function(){d[i]&&b.publish.apply(b,f),d[i]=null,c[i]=null},a.debounce)}}},{key:"renameTabs",value:function(a){var b=this.$container.querySelector(".jotted-nav");Object.keys(a).forEach(function(c){(b.querySelector('a[data-jotted-type="'+c+'"')||{}).innerHTML=a[c]})}}]),a}();return V.plugin=function(){return z.apply(this,arguments)},B(V),V});